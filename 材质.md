Cesium 通用材质类封装方案
一、 可封装的核心材质类型
基于 Cesium 原生 Material 体系，结合高频开发需求，规划以下 8 类常用材质：
图片纹理材质：加载本地 / 网络图片作为表面纹理，支持平铺、拉伸、旋转
纯色材质：单一颜色填充，支持透明度设置
线框材质：仅显示几何体的线框轮廓，可自定义线宽、颜色
网格材质：在表面绘制网格纹理，自定义网格大小、颜色、透明度
动态纹理材质：支持纹理动态偏移 / 缩放（如流动的水、滚动文字）
渐变颜色材质：线性 / 径向渐变填充，支持多色过渡
高亮 / 发光材质：边缘发光或表面高亮，用于选中态提示
复合材质：叠加多种材质（如图片 + 网格 + 高亮）
二、 材质类封装架构设计
1. 核心设计思路
采用 Class 封装 + 静态工厂方法 模式，统一材质创建 / 更新接口
抽离公共配置：纹理坐标、重复模式、透明度等
内置材质缓存池：相同配置复用实例，减少 M 系列芯片 Mac 性能损耗
提供 update 方法，支持动态修改材质参数

2. 完整封装代码（Cesium 1.118+ 可直接运行）
javascript
import * as Cesium from 'cesium';

/**
 * 统一材质封装类
 * 支持：图片/纯色/线框/网格/动态纹理/渐变/高亮/复合材质
 */
class CustomMaterial {
  // 材质缓存池：key为配置字符串，value为Material实例
  static CACHE = new Map();

  /**
   * 生成缓存key
   * @param {Object} options 材质配置
   * @returns {String} 唯一key
   */
  static getCacheKey(options) {
    return JSON.stringify(options);
  }

  /**
   * 创建图片纹理材质
   * @param {Object} options 配置项
   * @param {String} options.url 图片地址
   * @param {Number} [options.repeat=1] 纹理重复次数
   * @param {Number} [options.alpha=1] 透明度
   * @param {Boolean} [options.useCache=true] 是否使用缓存
   * @returns {Cesium.Material} 材质实例
   */
  static createImageMaterial(options) {
    const defaultOptions = { repeat: 1, alpha: 1, useCache: true };
    const opts = { ...defaultOptions, ...options };
    const cacheKey = this.getCacheKey(opts);

    // 缓存命中则直接返回
    if (opts.useCache && this.CACHE.has(cacheKey)) {
      return this.CACHE.get(cacheKey);
    }

    const material = new Cesium.Material({
      fabric: {
        type: 'Image',
        uniforms: {
          image: opts.url,
          repeat: new Cesium.Cartesian2(opts.repeat, opts.repeat),
          alpha: opts.alpha
        }
      }
    });

    // 存入缓存
    if (opts.useCache) {
      this.CACHE.set(cacheKey, material);
    }
    return material;
  }

  /**
   * 创建线框材质
   * @param {Object} options 配置项
   * @param {String} [options.color='#ffffff'] 线框颜色
   * @param {Number} [options.lineWidth=1] 线宽
   * @returns {Cesium.Material} 材质实例
   */
  static createWireframeMaterial(options) {
    const defaultOptions = { color: '#ffffff', lineWidth: 1 };
    const opts = { ...defaultOptions, ...options };

    return new Cesium.Material({
      fabric: {
        type: 'Wireframe',
        uniforms: {
          color: Cesium.Color.fromCssColorString(opts.color),
          lineWidth: opts.lineWidth
        }
      }
    });
  }

  /**
   * 创建纯色材质
   * @param {Object} options 配置项
   * @param {String} [options.color='#ffffff'] 颜色
   * @param {Number} [options.alpha=1] 透明度
   * @returns {Cesium.Material} 材质实例
   */
  static createColorMaterial(options) {
    const defaultOptions = { color: '#ffffff', alpha: 1 };
    const opts = { ...defaultOptions, ...options };
    const color = Cesium.Color.fromCssColorString(opts.color).withAlpha(opts.alpha);
    return Cesium.Material.fromType('Color', { color });
  }

  /**
   * 动态更新材质参数
   * @param {Cesium.Material} material 材质实例
   * @param {Object} uniforms 要更新的参数
   */
  static updateMaterial(material, uniforms) {
    Object.keys(uniforms).forEach(key => {
      if (material.uniforms.hasOwnProperty(key)) {
        material.uniforms[key] = uniforms[key];
      }
    });
  }

  /**
   * 清除材质缓存
   */
  static clearCache() {
    this.CACHE.clear();
  }
}

// ================== 使用示例 ==================
// 1. 创建图片材质并添加到3D几何体
const imageMaterial = CustomMaterial.createImageMaterial({
  url: '/assets/texture.png',
  repeat: 2,
  alpha: 0.8
});

// 2. 创建3D立方体并应用材质
const boxEntity = viewer.entities.add({
  name: '带图片材质的立方体',
  position: Cesium.Cartesian3.fromDegrees(116.40, 39.90, 100),
  box: {
    dimensions: new Cesium.Cartesian3(100, 100, 100),
    material: imageMaterial
  }
});

// 3. 动态修改材质透明度
setTimeout(() => {
  CustomMaterial.updateMaterial(imageMaterial, { alpha: 0.5 });
}, 2000);
三、 3D 几何体贴材质的关键说明
1. 可行性结论
Cesium 中所有 3D 几何体都支持贴材质，包括原生形状（Box、Sphere、Cylinder）和自定义 Primitive。
2. 两种应用方式
几何体类型	材质绑定方式	适用场景
Entity 原生形状	通过 shape.material 直接赋值	快速开发、简单场景
自定义 Primitive	通过 Appearance.material 赋值，配合 GeometryInstance	复杂自定义几何体
3. 注意事项
纹理坐标（UV）：原生几何体内置 UV 坐标，自定义几何体需手动定义 st 属性，否则纹理映射异常
性能优化（M 芯片 Mac 适配）：复用材质缓存、压缩大纹理图片（如 basis 格式）、避免频繁创建 Material 实例
四、 扩展材质封装示例（动态流动纹理）
基于 CustomMaterial 扩展动态材质方法，实现纹理流动效果：
javascript
/**
 * 创建动态流动纹理材质
 * @param {Object} options 配置项
 * @param {String} options.url 图片地址
 * @param {Number} [options.speed=0.1] 流动速度
 * @param {Number} [options.alpha=1] 透明度
 * @returns {Cesium.Material} 材质实例
 */
CustomMaterial.createFlowMaterial = function(options) {
  const opts = { speed: 0.1, url: '', alpha: 1, ...options };
  const material = new Cesium.Material({
    fabric: {
      type: 'Image',
      uniforms: {
        image: opts.url,
        repeat: new Cesium.Cartesian2(1, 1),
        offset: new Cesium.Cartesian2(0, 0),
        alpha: opts.alpha
      }
    }
  });

  // 监听时钟 tick 事件，动态更新纹理偏移量
  viewer.clock.onTick.addEventListener(() => {
    material.uniforms.offset.x += opts.speed * viewer.clock.tickDelta;
  });
  return material;
};

// 使用示例：创建流动水纹材质
const flowMaterial = CustomMaterial.createFlowMaterial({
  url: '/assets/water.png',
  speed: 0.2,
  alpha: 0.9
});